<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Markdown to HTML Converter</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
      background: #f5f5f5;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: #24292e;
      color: white;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    header .header-content {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    header h1 {
      font-size: 18px;
      font-weight: 600;
      margin: 0;
    }

    header p {
      font-size: 12px;
      color: #8b949e;
      margin: 0;
    }

    header .github-link {
      color: white;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 6px;
      transition: background 0.2s;
    }

    header .github-link:hover {
      background: rgba(255,255,255,0.1);
    }

    header .github-link svg {
      width: 20px;
      height: 20px;
    }

    .container {
      flex: 1;
      display: flex;
      gap: 0;
      overflow: hidden;
    }

    .panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: white;
      border-right: 1px solid #d0d7de;
    }

    .panel:last-child {
      border-right: none;
    }

    .panel-header {
      background: #f6f8fa;
      padding: 8px 12px;
      border-bottom: 1px solid #d0d7de;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .mode-switcher {
      display: flex;
      gap: 4px;
    }

    .mode-btn {
      padding: 6px 16px;
      background: white;
      color: #57606a;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .mode-btn:hover {
      background: #f3f4f6;
    }

    .mode-btn.active {
      background: #0969da;
      color: white;
      border-color: #0969da;
    }

    .panel-content {
      flex: 1;
      padding: 16px;
      overflow: auto;
    }

    .input-mode,
    .view-mode {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    textarea {
      width: 100%;
      height: 100%;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      padding: 12px;
      font-family: 'Consolas', 'Monaco', 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
      resize: none;
      outline: none;
    }

    textarea:focus {
      border-color: #0969da;
      box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.1);
    }

    .css-hint {
      margin-top: 12px;
      padding: 12px;
      background: #fff8c5;
      border: 1px solid #f0e68c;
      border-radius: 6px;
      font-size: 13px;
    }

    .css-hint p {
      margin: 0;
      color: #24292e;
    }

    .css-hint a {
      color: #0969da;
      text-decoration: none;
      font-weight: 500;
    }

    .css-hint a:hover {
      text-decoration: underline;
    }

    .preview-area {
      border: 1px solid #d0d7de;
      border-radius: 6px;
      padding: 20px;
      background: white;
      min-height: 100%;
      overflow: auto;
    }

    .controls {
      padding: 12px 16px;
      background: #f6f8fa;
      border-top: 1px solid #d0d7de;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .control-group {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .control-divider {
      width: 1px;
      height: 24px;
      background: #d0d7de;
      margin: 0 4px;
    }

    label {
      font-size: 13px;
      color: #24292e;
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      user-select: none;
    }

    input[type="checkbox"] {
      cursor: pointer;
    }

    input[type="text"] {
      padding: 6px 12px;
      border: 1px solid #d0d7de;
      border-radius: 6px;
      font-size: 13px;
      outline: none;
    }

    input[type="text"]:focus {
      border-color: #0969da;
      box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.1);
    }

    button {
      padding: 8px 16px;
      background: #2da44e;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
    }

    button:hover {
      background: #2c974b;
    }

    button:active {
      background: #298e46;
    }

    button.secondary {
      background: #f6f8fa;
      color: #24292e;
      border: 1px solid #d0d7de;
    }

    button.secondary:hover {
      background: #f3f4f6;
    }

    .status {
      font-size: 12px;
      color: #57606a;
      margin-left: auto;
    }

    /* å“åº”å¼å¸ƒå±€ */
    @media (max-width: 1024px) {
      .container {
        flex-direction: column;
      }

      .panel {
        border-right: none;
        border-bottom: 1px solid #d0d7de;
      }

      .controls {
        overflow-x: auto;
      }

      .control-divider {
        display: none;
      }

      header .header-content {
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
      }
    }

    @media (max-width: 640px) {
      header {
        flex-direction: column;
        gap: 12px;
      }

      .github-link {
        width: 100%;
        justify-content: center;
      }

      .mode-btn {
        padding: 6px 12px;
        font-size: 12px;
      }
    }

    /* åŠ è½½æç¤º */
    .loading {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 20px 40px;
      border-radius: 8px;
      font-size: 14px;
      display: none;
      z-index: 1000;
    }

    .loading.show {
      display: block;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <h1>Markdown2HTML</h1>
      <p>è½»é‡ï¼Œç¾è§‚çš„markdownè½¬HTMLã€‚(å¦å­˜ä¸º+æ‰“å°å¯ä»¥è½¬pdfï¼)</p>
    </div>
    <a href="https://github.com/RwandanMtGorilla/vscode-markdown-pdf" target="_blank" rel="noopener" class="github-link">
      <svg viewBox="0 0 16 16" fill="currentColor">
        <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
      </svg>
      <span>GitHub</span>
    </a>
  </header>

  <div class="container">
    <!-- å·¦ä¾§é¢æ¿: Markdown / CSS è¾“å…¥ -->
    <div class="panel left-panel">
      <div class="panel-header">
        <div class="mode-switcher">
          <button class="mode-btn active" data-mode="markdown">Markdown ç¼–è¾‘</button>
          <button class="mode-btn" data-mode="css">CSS æ ·å¼</button>
        </div>
      </div>
      <div class="panel-content">
        <!-- Markdown è¾“å…¥åŒº -->
        <div id="markdownMode" class="input-mode">
          <textarea id="markdownInput" placeholder="åœ¨è¿™é‡Œè¾“å…¥ Markdown å†…å®¹...
æ”¯æŒ:
- æ ‡å‡† Markdown è¯­æ³•
- ä»£ç è¯­æ³•é«˜äº®
- Mermaid å›¾è¡¨
- Emoji :smile:
- å¤é€‰æ¡† - [ ]
- è‡ªå®šä¹‰å®¹å™¨ ::: warning
- YAML Front Matter
"># æ¬¢è¿ä½¿ç”¨ Markdown2HTML

è¿™æ˜¯ä¸€ä¸ª**åŠŸèƒ½å¼ºå¤§**çš„ Markdown è½¬æ¢å™¨! (å¦å­˜ä¸º+æ‰“å°å¯ä»¥è½¬pdfï¼)

## ç‰¹æ€§

- âœ… æ”¯æŒæ ‡å‡† Markdown è¯­æ³•
- âœ… ä»£ç è¯­æ³•é«˜äº®
- âœ… Mermaid å›¾è¡¨
- âœ… Emoji è¡¨æƒ… :smile: :rocket:
- âœ… å¤é€‰æ¡†

## ä»£ç ç¤ºä¾‹

```javascript
function hello() {
  console.log('Hello, World!');
}
```

## å¤é€‰æ¡†

- [x] å·²å®Œæˆçš„ä»»åŠ¡
- [ ] å¾…å®Œæˆçš„ä»»åŠ¡

## Mermaid å›¾è¡¨

```mermaid
graph LR
    A[å¼€å§‹] --> B[å¤„ç†]
    B --> C[ç»“æŸ]
```

## è¡¨æ ¼

| åŠŸèƒ½ | çŠ¶æ€ |
|------|------|
| Markdown | âœ… |
| ä»£ç é«˜äº® | âœ… |
| Mermaid | âœ… |

> è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨å—
> å¯ä»¥åŒ…å«å¤šè¡Œæ–‡æœ¬
</textarea>
        </div>

        <!-- CSS ç¼–è¾‘åŒº -->
        <div id="cssMode" class="input-mode" style="display: none;">
          <textarea id="cssInput" placeholder="åœ¨è¿™é‡Œè¾“å…¥è‡ªå®šä¹‰ CSS æ ·å¼...">/* è‡ªå®šä¹‰æ ·å¼ç¤ºä¾‹ */
body {
  max-width: 900px;
  margin: 0 auto;
}

h1 {
  color: #2c3e50;
}

blockquote {
  border-left-color: #3498db;
  background-color: #ecf0f1;
}</textarea>
          <div class="css-hint">
            <p>ğŸ’¡ å¯ä»¥ä» <a href="https://theme.typora.io/" target="_blank" rel="noopener">Typora ä¸»é¢˜ç«™</a> ä¸‹è½½ç²¾ç¾çš„ CSS æ ·å¼</p>
          </div>
        </div>
      </div>
    </div>

    <!-- å³ä¾§é¢æ¿: HTML é¢„è§ˆ / ä»£ç  -->
    <div class="panel right-panel">
      <div class="panel-header">
        <div class="mode-switcher">
          <button class="mode-btn active" data-mode="preview">HTML é¢„è§ˆ</button>
          <button class="mode-btn" data-mode="code">HTML ä»£ç </button>
        </div>
      </div>
      <div class="panel-content">
        <!-- HTML é¢„è§ˆåŒº -->
        <div id="previewMode" class="view-mode">
          <div class="preview-area" id="preview">
            <p style="color: #666;">åœ¨å·¦ä¾§è¾“å…¥ Markdown,ç‚¹å‡»"è½¬æ¢"æŒ‰é’®æŸ¥çœ‹é¢„è§ˆ</p>
          </div>
        </div>

        <!-- HTML ä»£ç åŒº -->
        <div id="codeMode" class="view-mode" style="display: none;">
          <textarea id="htmlOutput" readonly placeholder="è½¬æ¢åçš„ HTML ä»£ç å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ..."></textarea>
        </div>
      </div>
    </div>
  </div>

  <div class="controls">
    <!-- åŠŸèƒ½é€‰é¡¹ -->
    <div class="control-group">
      <label>
        <input type="checkbox" id="configEmoji" checked>
        Emoji
      </label>
    </div>

    <div class="control-group">
      <label>
        <input type="checkbox" id="configBreaks">
        å¯ç”¨æ¢è¡Œ
      </label>
    </div>

    <div class="control-group">
      <label>
        <input type="checkbox" id="configHighlight" checked>
        ä»£ç é«˜äº®
      </label>
    </div>

    <div class="control-group">
      <label>
        <input type="checkbox" id="configGenerateToc">
        ç”Ÿæˆç›®å½•
      </label>
    </div>

    <div class="control-divider"></div>

    <!-- é«˜çº§é€‰é¡¹ -->
    <div class="control-group">
      <label for="highlightStyle">é«˜äº®ä¸»é¢˜:</label>
      <input type="text" id="highlightStyle" value="github" placeholder="github" style="width: 100px;">
    </div>

    <div class="control-group">
      <label for="tocPosition">ç›®å½•ä½ç½®:</label>
      <select id="tocPosition" style="padding: 5px 10px; border: 1px solid #d0d7de; border-radius: 6px; font-size: 12px; cursor: pointer;">
        <option value="top">é¡¶éƒ¨</option>
        <option value="bottom">åº•éƒ¨</option>
        <option value="none" selected>ä¸æ˜¾ç¤º</option>
      </select>
    </div>

    <div class="control-divider"></div>

    <!-- æ“ä½œæŒ‰é’® -->
    <button onclick="copyHtml()" class="secondary">ğŸ“‹ å¤åˆ¶ HTML</button>
    <button onclick="downloadHtml()" class="secondary">ğŸ’¾ ä¸‹è½½ HTML</button>

    <span class="status" id="status">å‡†å¤‡å°±ç»ª - è‡ªåŠ¨è½¬æ¢å·²å¯ç”¨</span>

    <!-- éšè—çš„é…ç½®é¡¹ -->
    <input type="checkbox" id="configDefaultStyles" checked style="display: none;">
    <input type="number" id="tocDepth" value="3" min="1" max="6" style="display: none;">
  </div>

  <div class="loading" id="loading">æ­£åœ¨è½¬æ¢...</div>

  <!-- å¼•å…¥å¿…è¦çš„åº“ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.2/markdown-it.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/markdown-it-checkbox@1.1.0/dist/markdown-it-checkbox.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/markdown-it-emoji@2.0.2/dist/markdown-it-emoji.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/markdown-it-container@3.0.0/dist/markdown-it-container.min.js"></script>

  <!-- å¼•å…¥è½¬æ¢å™¨ -->
  <script src="src/converter.js"></script>

  <script>
    let converter;

    // é˜²æŠ–å‡½æ•°
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }

    // åˆå§‹åŒ–
    window.addEventListener('DOMContentLoaded', () => {
      converter = new MarkdownConverter();
      updateStatus('å‡†å¤‡å°±ç»ª');

      // åˆå§‹åŒ–æ¨¡å¼åˆ‡æ¢
      initModeSwitchers();

      // åˆå§‹åŒ–è‡ªåŠ¨è½¬æ¢
      initAutoConvert();

      // åŠ è½½é»˜è®¤ CSS
      loadDefaultCSS();

      // è‡ªåŠ¨è½¬æ¢(é¦–æ¬¡åŠ è½½)
      setTimeout(() => {
        convertMarkdown();
      }, 500);
    });

    // åˆå§‹åŒ–è‡ªåŠ¨è½¬æ¢åŠŸèƒ½
    function initAutoConvert() {
      const debouncedConvert = debounce(convertMarkdown, 800);

      // ç›‘å¬ Markdown è¾“å…¥å˜åŒ–
      document.getElementById('markdownInput').addEventListener('input', debouncedConvert);

      // ç›‘å¬ CSS è¾“å…¥å˜åŒ–
      document.getElementById('cssInput').addEventListener('input', debouncedConvert);

      // ç›‘å¬æ‰€æœ‰é…ç½®é¡¹å˜åŒ–
      document.getElementById('configEmoji').addEventListener('change', convertMarkdown);
      document.getElementById('configHighlight').addEventListener('change', convertMarkdown);
      document.getElementById('configGenerateToc').addEventListener('change', convertMarkdown);
      document.getElementById('configBreaks').addEventListener('change', convertMarkdown);
      document.getElementById('highlightStyle').addEventListener('change', debouncedConvert);
      document.getElementById('tocPosition').addEventListener('change', convertMarkdown);
    }

    // åˆå§‹åŒ–æ¨¡å¼åˆ‡æ¢å™¨
    function initModeSwitchers() {
      // å·¦ä¾§é¢æ¿:Markdown / CSS åˆ‡æ¢
      const leftButtons = document.querySelectorAll('.left-panel .mode-btn');
      leftButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const mode = btn.dataset.mode;
          switchLeftMode(mode);

          // æ›´æ–°æŒ‰é’®çŠ¶æ€
          leftButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        });
      });

      // å³ä¾§é¢æ¿:é¢„è§ˆ / ä»£ç  åˆ‡æ¢
      const rightButtons = document.querySelectorAll('.right-panel .mode-btn');
      rightButtons.forEach(btn => {
        btn.addEventListener('click', () => {
          const mode = btn.dataset.mode;
          switchRightMode(mode);

          // æ›´æ–°æŒ‰é’®çŠ¶æ€
          rightButtons.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
        });
      });
    }

    // åˆ‡æ¢å·¦ä¾§æ¨¡å¼(Markdown / CSS)
    function switchLeftMode(mode) {
      const markdownMode = document.getElementById('markdownMode');
      const cssMode = document.getElementById('cssMode');

      if (mode === 'markdown') {
        markdownMode.style.display = 'flex';
        cssMode.style.display = 'none';
      } else if (mode === 'css') {
        markdownMode.style.display = 'none';
        cssMode.style.display = 'flex';
      }
    }

    // åˆ‡æ¢å³ä¾§æ¨¡å¼(é¢„è§ˆ / ä»£ç )
    function switchRightMode(mode) {
      const previewMode = document.getElementById('previewMode');
      const codeMode = document.getElementById('codeMode');

      if (mode === 'preview') {
        previewMode.style.display = 'flex';
        codeMode.style.display = 'none';
      } else if (mode === 'code') {
        previewMode.style.display = 'none';
        codeMode.style.display = 'flex';
      }
    }

    // åŠ è½½é»˜è®¤ CSS
    async function loadDefaultCSS() {
      try {
        const response = await fetch('styles/default-custom.css');
        if (response.ok) {
          const css = await response.text();
          document.getElementById('cssInput').value = css;
        }
      } catch (error) {
        console.log('é»˜è®¤ CSS æ–‡ä»¶æœªæ‰¾åˆ°,ä½¿ç”¨å†…ç½®æ ·å¼');
      }
    }

    // è½¬æ¢ Markdown
    function convertMarkdown() {
      try {
        showLoading(true);
        updateStatus('æ­£åœ¨è½¬æ¢...');

        const markdown = document.getElementById('markdownInput').value;
        const css = document.getElementById('cssInput').value;

        const config = {
          breaks: document.getElementById('configBreaks').checked,
          emoji: document.getElementById('configEmoji').checked,
          highlight: document.getElementById('configHighlight').checked,
          highlightStyle: document.getElementById('highlightStyle').value || 'github',
          includeDefaultStyles: document.getElementById('configDefaultStyles').checked,
          generateToc: document.getElementById('configGenerateToc').checked,
          tocPosition: document.getElementById('tocPosition').value,
          tocDepth: parseInt(document.getElementById('tocDepth').value) || 3
        };

        const html = converter.convert({
          markdown: markdown,
          css: css,
          title: 'Converted Document',
          config: config
        });

        // æ›´æ–°è¾“å‡º
        document.getElementById('htmlOutput').value = html;

        // æ›´æ–°é¢„è§ˆ
        const previewFrame = document.getElementById('preview');
        previewFrame.innerHTML = '';

        const iframe = document.createElement('iframe');
        iframe.style.width = '100%';
        iframe.style.height = '100%';
        iframe.style.border = 'none';
        previewFrame.appendChild(iframe);

        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
        iframeDoc.open();
        iframeDoc.write(html);
        iframeDoc.close();

        updateStatus('è½¬æ¢æˆåŠŸ!');
        showLoading(false);
      } catch (error) {
        console.error('è½¬æ¢å¤±è´¥:', error);
        updateStatus('è½¬æ¢å¤±è´¥: ' + error.message);
        showLoading(false);
        alert('è½¬æ¢å¤±è´¥: ' + error.message);
      }
    }

    // å¤åˆ¶ HTML
    function copyHtml() {
      const htmlOutput = document.getElementById('htmlOutput');
      htmlOutput.select();
      document.execCommand('copy');
      updateStatus('HTML å·²å¤åˆ¶åˆ°å‰ªè´´æ¿!');

      // ä¸´æ—¶æç¤º
      setTimeout(() => {
        updateStatus('å‡†å¤‡å°±ç»ª');
      }, 2000);
    }

    // ä¸‹è½½ HTML
    function downloadHtml() {
      const html = document.getElementById('htmlOutput').value;
      const blob = new Blob([html], { type: 'text/html' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'converted-' + Date.now() + '.html';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      updateStatus('HTML æ–‡ä»¶å·²ä¸‹è½½!');

      setTimeout(() => {
        updateStatus('å‡†å¤‡å°±ç»ª');
      }, 2000);
    }

    // æ›´æ–°çŠ¶æ€
    function updateStatus(message) {
      document.getElementById('status').textContent = message;
    }

    // æ˜¾ç¤º/éšè—åŠ è½½æç¤º
    function showLoading(show) {
      const loading = document.getElementById('loading');
      if (show) {
        loading.classList.add('show');
      } else {
        loading.classList.remove('show');
      }
    }

    // å¿«æ·é”®æ”¯æŒ
    document.addEventListener('keydown', (e) => {
      // Ctrl/Cmd + Enter: è½¬æ¢
      if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
        e.preventDefault();
        convertMarkdown();
      }
    });
  </script>
</body>
</html>
